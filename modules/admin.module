<?php
// $Id$

include_once "includes/common.inc";

function status($message) {
  if ($message) {
    return "<b>Status:</b> $message<hr />\n";
  }
}

function admin_link($type) {
  if ($type == "admin") {
    menu("admin", "Administration", NULL);
    menu("admin/sitemap", "sitemap", "sitemap_callback", NULL, 8);
  }
}

function sitemap_callback() {
  return menu_map("admin");
}

function admin_admin() {
  print menu_map();
}

function admin_page() {
  global $user, $base_url;

  if (user_access("access administration pages")) {
    page_header();

   ?>
    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">
    <html>
     <head>
      <title><?php echo variable_get("site_name", "drupal") . " " . t("administration pages"); ?></title>
      <base href="<?php echo "$base_url/" ?>" />
      <link rel="stylesheet" type="text/css" media="print" href="misc/print.css" />
      <style type="text/css" title="layout" media="Screen">
        @import url("misc/admin.css");
      </style>
     </head>
     <body>
      <?php
        // NOTE: we include a dummy "print.css" to remove the "flash of unstyled content" (FUOC) problems in IE.

        menu_build("admin");

        /*
        ** Body:
        */

        print "<a href=\"http://drupal.org/\"><img align=\"right\" src=\"misc/druplicon-small.gif\" alt=\"Druplicon - Drupal logo\" border=\"0\" /></a>";
        print "<div id=\"main\">";

        if ($path = menu_path()) {
          print "<h2>$path</h2>";
        }

        if ($help = menu_help()) {
          print "<small>$help</small>";
        }

        print "<hr />";

        if (arg(1)) {
          //print module_invoke(arg(1), "admin");
          print menu_execute_action();
        }
        else {
          print "<h2>". t("System messages") ."</h2>";
          print watchdog_overview("actions");
        }

        print "</div>";

        /*
        ** Menu:
        **   We rebuild the admin menu once more because one might have
        **   enabled/disabled themes or modules, changed permissions, etc.
        */

        menu_build("admin");

        print "<div id=\"menu\">";
        echo "<h1><a href=\"index.php\">". variable_get("site_name", "drupal") ."</a></h1>";
        print menu_tree("admin") ;
        print "</div>";
      ?>
    </body>
   </html>
   <?php
    page_footer();
  }
  else {
    print message_access();
  }
}

?>
