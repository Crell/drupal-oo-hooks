<?php

$module = array("cron" => "rating_cron",
                "help" => "rating_help",
                "page" => "rating_page",
                "block" => "rating_block");

function rating_cron() {
  $result = db_query("SELECT id FROM users");

  while ($account = db_fetch_object($result)) {
    db_query("UPDATE users SET rating = '". user_gravity($account->id) ."' WHERE id = '$account->id'");
  }
}

function rating_help() {
 ?>
  <P>The rating cron will periodically calculate each user's gravity, the overall time-weighted rating of each user's contributions.</P>
 <?
}

function rating_list($limit) {
  $result = db_query("SELECT userid, rating FROM users ORDER BY rating DESC LIMIT $limit");

  $output .= "<TABLE CELLPADDING=\"1\" CELLSPACING=\"1\">\n";
  while ($account = db_fetch_object($result)) {
    $output .= "<TR><TD ALIGN=\"right\">". ++$i ."</TD><TD>". format_username($account->userid) ."</TD><TD>". check_output($account->rating) ."</TD></TR>";
  }
  $output .= "</TABLE>\n";
  return $output;
}

function rating_page() {
  global $theme;
  $theme->header();
  $theme->box("Top 100 users", rating_list(100));
  $theme->footer();
}

function rating_block() {
  $block[0][subject] = "Top 10:<BR>users";
  $block[0][content] = rating_list(10);
  $block[0][info] = "Top 10: users";
  return $block;
}

?>