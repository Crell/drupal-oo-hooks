<?php
// $Id$

$GLOBALS["format"] = array(0 => "HTML", 1 => "PHP", 2 => "text");

function page_node($field) {
  $info["name"] = t("static page");
  $info["description"] = t("If you just want to add a static page with a link in the menu to your site, this would be the best choice.  Unlike a story, a page by-passes the submission queue.");

  return $info[$field];
}

function page_access($op, $node) {
  if ($op == "view") {
    return $node->status;
  }
}

function page_save($op, $node) {
  if ($op == "approve") {
    return array("status" => 1);
  }

  if ($op == "create") {
    return array("format", "link", "promote" => 0, "moderate" => 0, "status" => 1);
  }

  if ($op == "decline") {
    return array("status" => 0);
  }

  if ($op == "update") {
    return array("format", "link");
  }
}

function page_insert($node) {
  db_query("INSERT INTO page (nid, format, link) VALUES ('$node->nid', '$node->format', '$node->link')");
}

function page_update($node) {
  db_query("UPDATE page SET format = '$node->format', link = '$node->link' WHERE nid = '$node->nid'");
}

function page_delete($node) {
  db_query("DELETE FROM page WHERE nid = '$node->nid'");
}

function page_load($node) {
  $page = db_fetch_object(db_query("SELECT format, link FROM page WHERE nid = '$node->nid'"));
  return $page;
}

function page_link($type) {
  if ($type == "page") {
    $result = db_query("SELECT nid, link FROM page WHERE link != '' ORDER BY link");
    while ($page = db_fetch_object($result)) {
      $links[] = "<a href=\"node.php?id=$page->nid\">$page->link</a>";
    }
  }

  return $links ? $links : array();
}

function page_view($node, $main = 0) {
  global $format, $theme;

  switch ($format[$node->format]) {
    case "PHP":
      print eval($node->body);
      break;
    case "text":
      $theme->box($node->title, nl2br(htmlentities($node->body)));
      break;
    default:
      $theme->box($node->title, check_output($node->body, 1));
  }
}

function page_form($node, $help, $error) {
  global $format, $op;

  if ($op != t("Preview") && $format[$node->format] == "PHP") {
    $node->body = addslashes($node->body);
  }

  $output .= form_textarea("Body", "body", $node->body, 60, 20);
  $output .= form_textfield("Link", "link", $node->link, 60, 64);
  $output .= form_select("Type", "format", $node->format, $format);

  return $output;
}

?>