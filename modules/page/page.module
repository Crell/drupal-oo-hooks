<?php
// $Id$

$GLOBALS["format"] = array(0 => "HTML", 1 => "PHP", 2 => "text");

function page_link($type) {
  if ($type == "page") {
    $result = db_query("SELECT nid,link FROM page WHERE link != '' ORDER BY link");
    while ($page = db_fetch_object($result)) {
      $links[] = "<a href=\"node.php?id=$page->nid\">$page->link</a>";
    }
  }

  return $links ? $links : array();
}

function page_load($node) {
  $page = db_fetch_object(db_query("SELECT format, link FROM page WHERE nid = '$node->nid'"));
  return $page;
}

function page_view($node, $main = 0) {
  global $format, $theme;

  switch ($format[$node->format]) {
    case "PHP":
      print eval($node->body);
      break;
    case "text":
      $theme->box($node->title, nl2br(htmlentities($node->body)));
      break;
    default:
      $theme->box($node->title, check_output($node->body, 1));
  }

}

function page_form($node) {
  global $format, $op;

  if ($op != t("Preview") && $format[$node->format] == "PHP") {
    $node->body = addslashes($node->body);
  }

  $output .= form_textarea("Body", "body", $node->body, 60, 30);
  $output .= form_select("Type", "format", $node->format, $format);

  return $output;
}

function page_save() {

  if (user_access("administer nodes")) {
    if ($node->nid) {
      return array();
    }
    else {
      return array("promote" => 0, "moderate" => 0, "status" => 1);
    }
  }
  else {
    return 0;
  }

}



?>